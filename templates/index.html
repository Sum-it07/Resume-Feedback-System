<!DOCTYPE html>
<html lang="en">

<head>
    <title>Resume Feedback System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

    <div class="container">

        <h1>Resume Feedback System</h1>

        <div class="card">
            <form method="post" enctype="multipart/form-data">

                <label>Resume</label>
                <input type="file" name="resume_file" accept=".pdf,.docx,.txt">

                <label>Job Description</label>
                <input type="file" name="jd_file" accept=".pdf,.docx,.txt">

                <button type="submit">Analyze</button>

            </form>
        </div>

        {% if result %}

        <div class="card">
            <h2>Extracted Skills</h2>

            <p><strong>Resume Skills</strong></p>
            <div class="chip-group">
                {% for skill in result.resume_skill %}
                <span class="chip neutral">{{ skill }}</span>
                {% endfor %}
            </div>

            <p><strong>Job Skills</strong></p>
            <div class="chip-group">
                {% for skill in result.jd_skill %}
                <span class="chip neutral">{{ skill }}</span>
                {% endfor %}
            </div>
        </div>

        <div class="card">
            <h2>Skill Analysis</h2>

            <!-- Matched -->
            <div class="section">
                <h3>Matched ({{ result.match.summary.matched }})</h3>

                {% set matched = [] %}
                {% for skill, info in result.match.skills.items() %}
                {% if info.status == "matched" %}
                {% set _ = matched.append(skill) %}
                {% endif %}
                {% endfor %}

                {% if matched %}
                <div class="chip-group">
                    {% for skill in matched %}
                    <span class="chip matched">{{ skill }}</span>
                    {% endfor %}
                </div>
                {% else %}
                <p class="muted">No matched skills</p>
                {% endif %}
            </div>


            <!-- Partial -->
            <div class="section">
                <h3>Partial ({{ result.match.summary.partial }})</h3>

                {% set partial = [] %}
                {% for skill, info in result.match.skills.items() %}
                {% if info.status == "partial" %}
                {% set _ = partial.append((skill, info)) %}
                {% endif %}
                {% endfor %}

                {% if partial %}
                <div class="chip-group">
                    {% for skill, info in partial %}
                    <span class="chip partial" title="{{ info.evidence }}">
                        {{ skill }}
                        <span class="confidence">{{ (info.confidence * 100) | int }}%</span>
                    </span>
                    {% endfor %}
                </div>
                {% else %}
                <p class="muted">No partial matches</p>
                {% endif %}
            </div>

            <!-- Missing -->
            <div class="section">
                <h3>Missing ({{ result.match.summary.missing }})</h3>

                {% set missing = [] %}
                {% for skill, info in result.match.skills.items() %}
                {% if info.status == "missing" %}
                {% set _ = missing.append(skill) %}
                {% endif %}
                {% endfor %}

                {% if missing %}
                <div class="chip-group">
                    {% for skill in missing %}
                    <span class="chip missing">{{ skill }}</span>
                    {% endfor %}
                </div>
                {% else %}
                <p class="muted">No missing skills </p>
                {% endif %}
            </div>


            <div class="coverage-bar">
                <div class="coverage-fill" style="width: {{ result.match.summary.coverage | int }}%;">
                </div>

                <span>{{ result.match.summary.coverage }}% Coverage</span>
            </div>
        </div>

        <div class="card">
            <h2>Feedback</h2>
            <div class="feedback">
                {{ result.feedback | replace('\n', '<br>') | safe }}
            </div>
        </div>


        {% endif %}

    </div>

</body>

</html>